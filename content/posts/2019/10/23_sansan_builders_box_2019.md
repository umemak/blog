---
title: "Sansan Builders Box 2019"
date: "2019-10-23"
tags: ["event"]
---

Sansanの技術カンファレンスです。
2トラックのサイレントセッションで、受付時にレシーバーが配られました。
自分はサーバーレスが気になったので、トラック１の方に陣取りました。

https://sansan.connpass.com/event/138134/

## 14:30-15:00	【オープニング】 CTO 藤倉 成太、VP of Engineering 宍倉 功一
* 社員数550人中、ものづくに理に関わっているのが220名
* Sansanは何を目指しているのか
  - 世界中の名刺をすべてデジタル化
  - ビジネスパーソンの出会いのデータベース
* この１年の振り返り
  - 新規事業への取り組み
    - いくつか立ち上げ中
  - グローバルへの取り組み
    - 海外エンジニアの採用
    - 海外展開を見据えて
    - 英語だけでも仕事がまわせる環境
* これからの挑戦
  - 組織を強くしていく
    - 新規事業、事業の加速
    - 事業の成果にクリエイターが向き合う
    - 成果の出しやすい環境
    - 協働・変容
  - 研究のネタを議論する
    - R&Dが事業をリードする

## 15:10-15:35	「Sansanアーキテクチャ史」荒川 聖悟
* sansanは12年間の歴史がある
* C#
* v1
  - WinForms(UI), BLL(busineslogic layer), DAL(DataAccessLayer)
  - DALはSQLを手作業で組み立てている
  - Pros: とにかくシンプル、画面と業務ロジックの結びつきが明確
  - Cons: 画面駆動アーキテクチャになりがち、各レイヤの責務が曖昧

* v2
  - Service, DomainModel, Repository
  - DDDっぽい雰囲気
  - ORマッパーを自作した
    - リポジトリ層が超肥大化
  - 課題
    - リポジトリの肥大化によりサービス層の実装が困難に
    - 共通化の認識を共通化させることができなかった
    - FE固有のロジックが共通されたりしていた
    - パフォーマンスが出ない
      - クエリが多い＆謎
  - 画面駆動からは脱却できた

* V3
  - UI, App, Domain, Infra
  - UI層（WEB, API）にQueryServiceを置く（SELECT文のみ）
  - ORマッパーは使わず、SQLを直書きに変更
  - シンプルと共通化のバランスが取れている
  - 無駄な抽象化は避けている
  - 課題
    - モジュールの場所や実装の悩み

* まとめ
  - 時代とともに流行のアーキテクチャは移り変わる
  - アーキテクチャの浸透は想像以上に難しい
  - プラットフォームとアプリケーションにあったアーキテクチャを選ぶ

## 15:40-16:05	「Eightのフロントエンド〜改善の歴史と今後の展望〜」青山 修平
* バックエンドはRails
* 2012/2 jQuery UI
* 2013/4 Backbone.js + jQuery UI + CoffeeScript
* 2015/12 React + Redux + ES6
* 課題と改善
  - UI
    - モノリシックCSS
      - 影響範囲がわからず、ちょっとした修正ができなくなる
        - →CSSのコンポーネント化で解消
    - バラバラなスタイル、コンポーネント
      - 同じようなコンポーネントが微妙に違ってあちこちに点在
        - →スタイルガイドを作成して改善
    - 新スタイルガイド刷新中
      - デザイナを巻き込んですすめる
  - 煩雑な提携コード作成
    - OpenAPI(Swagger)採用
    - 194個
    - →swagger-client, normalizr を利用してコードを生成する

## 16:15-16:40	「GCP サーバーレス サービス × 少数チームで新たなデータ化サービスを立ち上げる」木田 悠一郎
* 名刺の高精度なデータ化を支えるノウハウ
  - 機械の力と人の力を合わせる
* GCPサーバーレスサービス紹介
  - GAE, CFirestore, CTasks, Sd, CStrage, CFunction
  - GAE: スケールアウト・デプロイが高速
  - FIrestore: NoSQLデータストア、オートスケーリング
  - Tasks: 処理を非同期で実行できるタスクキューサービス
  - Stackdriver: ロギング、エラー通知、モニタリングで使用
* アーキテクチャ
  - 導入の背景
    - 運用負荷を下げたい
    - マルチクラウドを推進
    - チャレンジ
      - 本気で使ってみることで、メリデメを理解する
* メリット・注意点・課題
  - アプリケーションのコードに集中できる
  - サーバー管理不要
  - コスト最適化
  + 限られたリソースでもスピード感を持って開発できる
  - GAE環境
    - 可能な限りスタンダード環境を使う（フレキシブル環境ではなく）
    - AWS環境とVPN接続したいとき
    - 特定のライブラリを使いたいとき
      - いまはCloudRunで代用できる
  - AppEngineファイアウォール
    - グローバルサービスがブロックされて住まう
  - FirestoreのDB設計
    - count関数はない
    - 分散カウンタを使う
* 課題
  - 開発環境
    - Firestore: 1プロジェクトに1DB
    - Tasks: ローカルに向けられない
  - 動作確認
    - HerokuReview
  - 分析計クエリ
  - エラー通知
    - タイムラグ・カスタマイズ
* Q&A
  - AWSとGCPのサーバーレスの違い
    - マネージド具合はCGPのほうが心地よい
    - GAEの使い勝手が良い

## 16:45-17:10	「新規事業の開発メンバーが1人→n人に増えるのを支えた技術」加藤 耕太
* データ不正更新事件
  - id:1のデータを編集したあとにid:2を編集すると、意図せずid:1のデータも変更されてしまう
  - 3000件を目視確認
  - 問題が起きると、調査対応に莫大な工数がかかる
  - 安定したインフラで素早く動け（Facebookのモットーより）
* 対策
  - コードフォーマッターの導入
    - 融通がきかないルールもそのうちなれる
    - リポジトリ一括フォーマットはマージのタイムングが難しいので、なるべく初期に導入する
  - CIの導入
    - Cloud Build
    - とりあえずビルドだけでもやっておくと安心
  - 静的型付け言語（Kotlin）への移行
    - 言語選定条件：GAEスタンダード第2世代のランタイム＆静的型付け言語
    - Pythonからの段階的な移行
      - コアドメインの機能をKotlin化して切り出し
      - BFF部分を徐々に移行
  - テストを書きやすい環境づくり
    - コントローラーのテストを気軽に書きたい
    - テストクラスごとに異なるスキーマに接続して並列実行
      - CI環境ではコミットIDごとにスキーマを分ける（並列ビルド対策）
    - テストがあると安心してリファクタリングできる
  - GAEのデプロイ自動化
    - リリース作業に時間がかかる
    - トラフィック移行は手動で実行する
    - フレキシブル環境を自動デプロイする場合は要注意
      - トラフィックを受け取らなくてもデフォルト2インスタンスが起動し続ける

## 17:25-17:50	「プロダクトをどう磨いていくか」片芝 亮友

## 17:55-18:20	「チームづくりから組織づくりへ〜事業成長に立ち向かうEMの戦略と戦術」谷内 真裕 

## 18:30-18:55	【クロージング】 「明日の当たり前を作る」CPO 大津 裕史

## 19:00-20:30	【懇親会】 Builders Night
