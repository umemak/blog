<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Go on umemak</title><link>https://umemak.github.io/blog/tags/go/</link><description>Recent content in Go on umemak</description><generator>Hugo</generator><language>ja-jp</language><copyright>This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</copyright><lastBuildDate>Wed, 24 May 2023 00:00:00 +0000</lastBuildDate><atom:link href="https://umemak.github.io/blog/tags/go/index.xml" rel="self" type="application/rss+xml"/><item><title>GitHub Actionsでコンテナイメージを登録する</title><link>https://umemak.github.io/blog/posts/2023/05/24_github_actions_ko/</link><pubDate>Wed, 24 May 2023 00:00:00 +0000</pubDate><guid>https://umemak.github.io/blog/posts/2023/05/24_github_actions_ko/</guid><description>&lt;p>&lt;a href="https://github.com/ko-build/setup-ko">ko-build/setup-ko&lt;/a> を使ったら簡単にできた。&lt;/p>
&lt;p>&lt;a href="https://github.com/umemak/kindle_xml_to_tsv/blob/main/.github/workflows/ko.yml">https://github.com/umemak/kindle_xml_to_tsv/blob/main/.github/workflows/ko.yml&lt;/a>で&lt;a href="https://github.com/umemak/kindle_xml_to_tsv/pkgs/container/kindle_xml_to_tsv%2Fkindle_xml_to_tsv-f222ca7f0849cd5cfa2ae78a69f0ff9a">https://github.com/umemak/kindle_xml_to_tsv/pkgs/container/kindle_xml_to_tsv%2Fkindle_xml_to_tsv-f222ca7f0849cd5cfa2ae78a69f0ff9a&lt;/a>こう。&lt;/p>
&lt;p>最初実行したときに権限のエラーが出て、&lt;a href="https://blog.yukirii.dev/github-action-ghcr-push-error/">GitHub Action で GHCR へのコンテナー イメージの Push が成功しない (permission_denied: write_package) - yukirii blog&lt;/a>を参考に&lt;code>Write&lt;/code>にして再実行したらエラー解消した。&lt;/p>
&lt;p>ただ、最初の権限が&lt;code>Admin&lt;/code>だったし、エラー出つつも物はアップロードされていたので謎。&lt;/p></description></item><item><title>Amazonの書籍ページパースできなくなった</title><link>https://umemak.github.io/blog/posts/2023/05/01_amazon_html/</link><pubDate>Mon, 01 May 2023 00:00:00 +0000</pubDate><guid>https://umemak.github.io/blog/posts/2023/05/01_amazon_html/</guid><description>&lt;p>&lt;a href="https://github.com/umemak/asin2md">umemak/asin2md&lt;/a>で書籍情報取得しようとしたらできなくなってて、レスポンスの中身見たらなんか思ってたのと違うのになってた。&lt;/p>
&lt;p>10日くらい前に使ったときは問題なかったので、キャンペーンのせいとかだったら良いのだけど。&lt;/p>
&lt;p>恒久的に変わるといろいろやり直しになるので面倒。。&lt;/p></description></item><item><title>urfave/cliその2</title><link>https://umemak.github.io/blog/posts/2023/03/26_cli/</link><pubDate>Sun, 26 Mar 2023 00:00:00 +0000</pubDate><guid>https://umemak.github.io/blog/posts/2023/03/26_cli/</guid><description>&lt;p>v2がエラーになる件、Codespacesでも問題なかった。いよいよWindowsの問題な気がしてきた。&lt;/p>
&lt;p>→上位ディレクトリの&lt;code>go.work&lt;/code>に追加したら、&lt;code>go run&lt;/code>時のエラーは解消した。&lt;/p>
&lt;p>VS Code再起動したら、ソースのエラー表示も消えた。&lt;/p>
&lt;p>&lt;code>go.work&lt;/code>に原因あるとかわかりにくすぎる。。&lt;/p></description></item><item><title>urfave/cli</title><link>https://umemak.github.io/blog/posts/2023/03/25_cli/</link><pubDate>Sat, 25 Mar 2023 00:00:00 +0000</pubDate><guid>https://umemak.github.io/blog/posts/2023/03/25_cli/</guid><description>&lt;p>&lt;a href="https://gihyo.jp/dp/ebook/2023/978-4-297-13420-4">Go言語プログラミングエッセンス | Gihyo Digital Publishing&lt;/a>で紹介されていた、&lt;a href="https://github.com/urfave/cli">urfave/cli: A simple, fast, and fun package for building command line apps in Go&lt;/a>を使ってみたのだけど、エラーで動かない。&lt;/p>
&lt;p>&lt;code>no required module provides package github.com/urfave/cli/v2&lt;/code>というエラー。v1だとエラーは出ない。v2とv3がダメ。&lt;/p>
&lt;p>試しにGitpodで動かしてみたら、エラー出なかった。&lt;/p>
&lt;p>Windowsの問題？&lt;/p></description></item><item><title>go.sumを消してみた</title><link>https://umemak.github.io/blog/posts/2023/02/25_github_security/</link><pubDate>Sat, 25 Feb 2023 00:00:00 +0000</pubDate><guid>https://umemak.github.io/blog/posts/2023/02/25_github_security/</guid><description>&lt;p>go.sum消したのにまたGitHubからメールが来た。&lt;/p>
&lt;p>古い情報をもとにセキュリティチェックしているのかなぁ。&lt;/p>
&lt;p>どうするのが正解なんだろう。&lt;/p></description></item><item><title>go.sumを消してみる</title><link>https://umemak.github.io/blog/posts/2023/02/24_github_security/</link><pubDate>Fri, 24 Feb 2023 00:00:00 +0000</pubDate><guid>https://umemak.github.io/blog/posts/2023/02/24_github_security/</guid><description>&lt;p>GitHubのセキュリティメールが最近頻繁に来て、古いテスト用のリポジトリだったので、アラート対象になっている&lt;code>go.sum&lt;/code>ファイルを消してみた。&lt;/p>
&lt;p>これが正しい対応なのかわからないけど、&lt;code>go.mod&lt;/code>で指定しているバージョンより古いもののsumが書かれていて、&lt;code>go mod tidy&lt;/code>しても消えず、ファイルを消して&lt;code>go mod tidy&lt;/code>したら復活するうえに、それがアラート対象になるのだから納得いかない。&lt;/p></description></item><item><title>GoReleaser</title><link>https://umemak.github.io/blog/posts/2023/01/24_goreleaser/</link><pubDate>Tue, 24 Jan 2023 00:00:00 +0000</pubDate><guid>https://umemak.github.io/blog/posts/2023/01/24_goreleaser/</guid><description>&lt;p>&lt;a href="https://goreleaser.com/">GoReleaser - GoReleaser&lt;/a>使ってみた。&lt;/p>
&lt;p>うまく動かなかった。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>$ go install github.com/goreleaser/goreleaser@latest
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ goreleaser init
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ goreleaser release --snapshot --rm-dist
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> • starting release...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> • loading config file file&lt;span style="color:#f92672">=&lt;/span>.goreleaser.yaml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> • loading environment variables
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> • getting and validating git state
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> • ignoring errors because this is a snapshot error&lt;span style="color:#f92672">=&lt;/span>git doesn&lt;span style="color:#960050;background-color:#1e0010">&amp;#39;&lt;/span>t contain any tags. Either add a tag or use --snapshot
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> • building... commit&lt;span style="color:#f92672">=&lt;/span>c555bfd95c67f41425d8155510f376d0015665eb latest tag&lt;span style="color:#f92672">=&lt;/span>v0.0.0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> • pipe skipped reason&lt;span style="color:#f92672">=&lt;/span>disabled during snapshot mode
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> • parsing tag
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> • setting defaults
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> • running before hooks
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> • running hook&lt;span style="color:#f92672">=&lt;/span>go mod tidy
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> • running hook&lt;span style="color:#f92672">=&lt;/span>go generate ./...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> • took: 6s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> • snapshotting
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> • building snapshot... version&lt;span style="color:#f92672">=&lt;/span>0.0.1-next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> • checking distribution directory
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> • loading go mod information
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> • build prerequisites
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> • writing effective config file
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> • writing config&lt;span style="color:#f92672">=&lt;/span>dist&lt;span style="color:#ae81ff">\c&lt;/span>onfig.yaml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> • building binaries
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> • building binary&lt;span style="color:#f92672">=&lt;/span>dist&lt;span style="color:#ae81ff">\a&lt;/span>sin2md_linux_386&lt;span style="color:#ae81ff">\a&lt;/span>sin2md
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> • building binary&lt;span style="color:#f92672">=&lt;/span>dist&lt;span style="color:#ae81ff">\a&lt;/span>sin2md_linux_amd64_v1&lt;span style="color:#ae81ff">\a&lt;/span>sin2md
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> • building binary&lt;span style="color:#f92672">=&lt;/span>dist&lt;span style="color:#ae81ff">\a&lt;/span>sin2md_windows_amd64_v1&lt;span style="color:#ae81ff">\a&lt;/span>sin2md.exe
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> • building binary&lt;span style="color:#f92672">=&lt;/span>dist&lt;span style="color:#ae81ff">\a&lt;/span>sin2md_darwin_amd64_v1&lt;span style="color:#ae81ff">\a&lt;/span>sin2md
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> • building binary&lt;span style="color:#f92672">=&lt;/span>dist&lt;span style="color:#ae81ff">\a&lt;/span>sin2md_linux_arm64&lt;span style="color:#ae81ff">\a&lt;/span>sin2md
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> • building binary&lt;span style="color:#f92672">=&lt;/span>dist&lt;span style="color:#ae81ff">\a&lt;/span>sin2md_windows_arm64&lt;span style="color:#ae81ff">\a&lt;/span>sin2md.exe
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> • building binary&lt;span style="color:#f92672">=&lt;/span>dist&lt;span style="color:#ae81ff">\a&lt;/span>sin2md_darwin_arm64&lt;span style="color:#ae81ff">\a&lt;/span>sin2md
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> • building binary&lt;span style="color:#f92672">=&lt;/span>dist&lt;span style="color:#ae81ff">\a&lt;/span>sin2md_windows_386&lt;span style="color:#ae81ff">\a&lt;/span>sin2md.exe
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ⨯ release failed after 6s error&lt;span style="color:#f92672">=&lt;/span>build &lt;span style="color:#66d9ef">for&lt;/span> asin2md does not contain a main &lt;span style="color:#66d9ef">function&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Learn more at https://goreleaser.com/errors/no-main
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;a href="https://goreleaser.com/errors/no-main/#if-your-maingo-is-not-in-the-root-folder">ドキュメント&lt;/a>によると、mainパッケージがルート以外のときはパスを指定しないといけないらしい。&lt;/p></description></item><item><title>gRPC Connect</title><link>https://umemak.github.io/blog/posts/2023/01/20_grpc_connect/</link><pubDate>Fri, 20 Jan 2023 00:00:00 +0000</pubDate><guid>https://umemak.github.io/blog/posts/2023/01/20_grpc_connect/</guid><description>&lt;p>&lt;a href="https://github.com/bufbuild/connect-go">bufbuild/connect-go: Simple, reliable, interoperable. A better gRPC.&lt;/a>&lt;/p>
&lt;p>テスト用にgRPCのサーバーが欲しかったので、使ってみた。&lt;/p>
&lt;p>READMEに書いてあるサンプルのように作ったら、grpcurlでリフレクションのエラーになったので、&lt;a href="https://zenn.dev/rai_wtnb/articles/e07ad831ea8e34">次世代gRPC?『connect-go』やってみた&lt;/a>を参考にリフレクションを入れたら動いた。&lt;/p>
&lt;p>ついでにクライアントもConnectで書いてみた。&lt;/p>
&lt;p>サーバーの指定をプロトコル込み（http://～/）で指定しないといけないのと、RequestとResponceにMsgを挟まないといけないので少しハマったけど、おおむね問題なさそう。&lt;/p></description></item><item><title>goでmissing go.sum entry cacheエラー</title><link>https://umemak.github.io/blog/posts/2023/01/17_go_mod_sum/</link><pubDate>Tue, 17 Jan 2023 00:00:00 +0000</pubDate><guid>https://umemak.github.io/blog/posts/2023/01/17_go_mod_sum/</guid><description>&lt;p>昨日の&lt;code>go build&lt;/code>でエラーになって&lt;code>go run&lt;/code>だと動く件、正確にはbuildのほうはmake経由での実行で、runは直接という違いがあった。&lt;/p>
&lt;p>goのバージョン管理について、新しいバージョンが出たら&lt;a href="https://go.dev/doc/manage-install">Managing Go installations - The Go Programming Language&lt;/a>のように&lt;code>go install&lt;/code>を使ってインストールしていて、aliasでインストールした先を&lt;code>go&lt;/code>としていた。&lt;/p></description></item><item><title>goでmissing go.sum entry cacheエラー</title><link>https://umemak.github.io/blog/posts/2023/01/16_go_mod_sum/</link><pubDate>Mon, 16 Jan 2023 00:00:00 +0000</pubDate><guid>https://umemak.github.io/blog/posts/2023/01/16_go_mod_sum/</guid><description>&lt;p>&lt;code>go build&lt;/code>しようとすると&lt;code>missing go.sum entry cache&lt;/code>なエラーが出る。&lt;/p>
&lt;p>ググっても&lt;code>go mod tidy&lt;/code>すれば直る的なものしかヒットせず。&lt;/p>
&lt;p>&lt;code>go clean --modcache&lt;/code>してみてもダメ。&lt;/p>
&lt;p>&lt;code>go run&lt;/code>だと実行できてしまうので余計訳が分からない。&lt;/p></description></item></channel></rss>