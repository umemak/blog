<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>FastAPI on umemak</title><link>https://umemak.github.io/blog/tags/fastapi/</link><description>Recent content in FastAPI on umemak</description><generator>Hugo</generator><language>ja-jp</language><copyright>This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</copyright><lastBuildDate>Tue, 10 Oct 2023 00:00:00 +0000</lastBuildDate><atom:link href="https://umemak.github.io/blog/tags/fastapi/index.xml" rel="self" type="application/rss+xml"/><item><title>FastAPI入門2</title><link>https://umemak.github.io/blog/posts/2023/10/10_fastapi/</link><pubDate>Tue, 10 Oct 2023 00:00:00 +0000</pubDate><guid>https://umemak.github.io/blog/posts/2023/10/10_fastapi/</guid><description>&lt;p>昨日の続き。テストを流した時のエラーは、参考にしたサイトのものと一部バージョンが変わっているのが原因らしく。&lt;/p>
&lt;p>&lt;a href="https://www.beex-inc.com/blog/rejoin-nasu">pytest-asyncio のモードのデフォルト値が変わったよ＆出戻りのご連絡｜基幹システムのクラウド移行・構築・導入支援のBeeX&lt;/a>&lt;/p>
&lt;p>を参考に&lt;code>@pytest.fixture&lt;/code>を&lt;code>@pytest_asyncio.fixture&lt;/code>に変更したら解消した。&lt;/p></description></item><item><title>FastAPI入門</title><link>https://umemak.github.io/blog/posts/2023/10/09_fastapi/</link><pubDate>Mon, 09 Oct 2023 00:00:00 +0000</pubDate><guid>https://umemak.github.io/blog/posts/2023/10/09_fastapi/</guid><description>&lt;p>&lt;a href="https://zenn.dev/sh0nk/books/537bb028709ab9">FastAPI入門&lt;/a>をやってみた。&lt;/p>
&lt;p>特にひっかかることなく進めたが、最後のテストがPASSしない。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>$ docker-compose run --entrypoint &lt;span style="color:#e6db74">&amp;#34;poetry run pytest&amp;#34;&lt;/span> demo-app
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>+&lt;span style="color:#f92672">]&lt;/span> Building 0.0s &lt;span style="color:#f92672">(&lt;/span>0/0&lt;span style="color:#f92672">)&lt;/span> docker:default 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>+&lt;span style="color:#f92672">]&lt;/span> Building 0.0s &lt;span style="color:#f92672">(&lt;/span>0/0&lt;span style="color:#f92672">)&lt;/span> docker:default 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">=======================================================&lt;/span> test session starts &lt;span style="color:#f92672">========================================================&lt;/span>platform linux -- Python 3.9.17, pytest-7.4.2, pluggy-1.3.0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rootdir: /src
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>plugins: anyio-3.7.1, asyncio-0.21.1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>asyncio: mode&lt;span style="color:#f92672">=&lt;/span>strict
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>collected &lt;span style="color:#ae81ff">2&lt;/span> items 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>tests/test_main.py FF &lt;span style="color:#f92672">[&lt;/span>100%&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">=============================================================&lt;/span> FAILURES &lt;span style="color:#f92672">=============================================================&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>_______________________________________________________ test_create_and_read _______________________________________________________
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>async_client &lt;span style="color:#f92672">=&lt;/span> &amp;lt;async_generator object async_client at 0x7f8d3374dca0&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> @pytest.mark.asyncio
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> async def test_create_and_read&lt;span style="color:#f92672">(&lt;/span>async_client&lt;span style="color:#f92672">)&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; response &lt;span style="color:#f92672">=&lt;/span> await async_client.post&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#e6db74">&amp;#34;/tasks&amp;#34;&lt;/span>, json&lt;span style="color:#f92672">={&lt;/span>&lt;span style="color:#e6db74">&amp;#34;title&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;テストタスク&amp;#34;&lt;/span>&lt;span style="color:#f92672">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>E AttributeError: &lt;span style="color:#e6db74">&amp;#39;async_generator&amp;#39;&lt;/span> object has no attribute &lt;span style="color:#e6db74">&amp;#39;post&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>tests/test_main.py:41: AttributeError
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>__________________________________________________________ test_done_flag __________________________________________________________
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>async_client &lt;span style="color:#f92672">=&lt;/span> &amp;lt;async_generator object async_client at 0x7f8d3374ddc0&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> @pytest.mark.asyncio
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> async def test_done_flag&lt;span style="color:#f92672">(&lt;/span>async_client&lt;span style="color:#f92672">)&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; response &lt;span style="color:#f92672">=&lt;/span> await async_client.post&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#e6db74">&amp;#34;/tasks&amp;#34;&lt;/span>, json&lt;span style="color:#f92672">={&lt;/span>&lt;span style="color:#e6db74">&amp;#34;title&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;テストタスク2&amp;#34;&lt;/span>&lt;span style="color:#f92672">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>E AttributeError: &lt;span style="color:#e6db74">&amp;#39;async_generator&amp;#39;&lt;/span> object has no attribute &lt;span style="color:#e6db74">&amp;#39;post&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>tests/test_main.py:56: AttributeError
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">=========================================================&lt;/span> warnings summary &lt;span style="color:#f92672">=========================================================&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>.venv/lib/python3.9/site-packages/pydantic/fields.py:798
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> /src/.venv/lib/python3.9/site-packages/pydantic/fields.py:798: PydanticDeprecatedSince20: Using extra keyword arguments on &lt;span style="color:#e6db74">`&lt;/span>Field&lt;span style="color:#e6db74">`&lt;/span> is deprecated and will be removed. Use &lt;span style="color:#e6db74">`&lt;/span>json_schema_extra&lt;span style="color:#e6db74">`&lt;/span> instead. &lt;span style="color:#f92672">(&lt;/span>Extra keys: &lt;span style="color:#e6db74">&amp;#39;example&amp;#39;&lt;/span>&lt;span style="color:#f92672">)&lt;/span>. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.4/migration/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> warn&lt;span style="color:#f92672">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>.venv/lib/python3.9/site-packages/pydantic/_internal/_config.py:267
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>.venv/lib/python3.9/site-packages/pydantic/_internal/_config.py:267
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>.venv/lib/python3.9/site-packages/pydantic/_internal/_config.py:267
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> /src/.venv/lib/python3.9/site-packages/pydantic/_internal/_config.py:267: PydanticDeprecatedSince20: Support &lt;span style="color:#66d9ef">for&lt;/span> class-based &lt;span style="color:#e6db74">`&lt;/span>config&lt;span style="color:#e6db74">`&lt;/span> is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.4/migration/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> warnings.warn&lt;span style="color:#f92672">(&lt;/span>DEPRECATION_MESSAGE, DeprecationWarning&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>.venv/lib/python3.9/site-packages/pydantic/_internal/_config.py:317
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> /src/.venv/lib/python3.9/site-packages/pydantic/_internal/_config.py:317: UserWarning: Valid config keys have changed in V2:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> * &lt;span style="color:#e6db74">&amp;#39;orm_mode&amp;#39;&lt;/span> has been renamed to &lt;span style="color:#e6db74">&amp;#39;from_attributes&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> warnings.warn&lt;span style="color:#f92672">(&lt;/span>message, UserWarning&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">=====================================================&lt;/span> short test summary info &lt;span style="color:#f92672">======================================================&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>FAILED tests/test_main.py::test_create_and_read - AttributeError: &lt;span style="color:#e6db74">&amp;#39;async_generator&amp;#39;&lt;/span> object has no attribute &lt;span style="color:#e6db74">&amp;#39;post&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>FAILED tests/test_main.py::test_done_flag - AttributeError: &lt;span style="color:#e6db74">&amp;#39;async_generator&amp;#39;&lt;/span> object has no attribute &lt;span style="color:#e6db74">&amp;#39;post&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">==================================================&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> failed, &lt;span style="color:#ae81ff">5&lt;/span> warnings in 29.49s &lt;span style="color:#f92672">==================================================&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>