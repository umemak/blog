<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Docker on umemak</title><link>https://umemak.github.io/blog/tags/docker/</link><description>Recent content in Docker on umemak</description><generator>Hugo</generator><language>ja-jp</language><copyright>This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</copyright><lastBuildDate>Tue, 21 Nov 2023 00:00:00 +0000</lastBuildDate><atom:link href="https://umemak.github.io/blog/tags/docker/index.xml" rel="self" type="application/rss+xml"/><item><title>DockerでNGINXを動かすとClientIPが取れない</title><link>https://umemak.github.io/blog/posts/2023/11/21_docker_nginx/</link><pubDate>Tue, 21 Nov 2023 00:00:00 +0000</pubDate><guid>https://umemak.github.io/blog/posts/2023/11/21_docker_nginx/</guid><description>&lt;p>SvelteKitアプリでアクセス元IPアドレスを見て処理を分けたかった。&lt;/p>
&lt;p>ローカル環境では&lt;code>Handle&lt;/code>で&lt;code>event.getClientAddress()&lt;/code>したら取れていた。&lt;/p>
&lt;p>SvelteKitはログが寂しいので、手前にNGINXを置いてアクセスログを詳細にとれるようにしてみた。&lt;/p>
&lt;p>ローカルにNGINXインストールするのはちょっとあれだったので、docker composeで組んだ。&lt;/p></description></item><item><title>docker composeのファイル名</title><link>https://umemak.github.io/blog/posts/2023/07/03_compose/</link><pubDate>Mon, 03 Jul 2023 00:00:00 +0000</pubDate><guid>https://umemak.github.io/blog/posts/2023/07/03_compose/</guid><description>&lt;p>&lt;a href="https://gihyo.jp/dp/ebook/2023/978-4-297-13572-0">WEB+DB PRESS Vol.135 | Gihyo Digital Publishing&lt;/a>を読んでいて、docker composeの設定例がcompose.yamlになっているのが気になってググったら、compose V2から推奨が変わったらしい。&lt;/p>
&lt;p>時代に乗り遅れていた。&lt;/p>
&lt;p>参考：&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://docs.docker.com/compose/compose-file/03-compose-file/">The Compose file | Docker Documentation&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://zenn.dev/miroha/articles/whats-docker-compose-v2">Docker Compose V2で変わったdocker-compose.ymlの書き方&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://qiita.com/minamijoyo/items/33c8a256d2916f554016">dockerfile_inlineでcompose.yamlにDockerfileをインラインで書く - Qiita&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>DockerでSpring Boot</title><link>https://umemak.github.io/blog/posts/2023/01/19_spring/</link><pubDate>Thu, 19 Jan 2023 00:00:00 +0000</pubDate><guid>https://umemak.github.io/blog/posts/2023/01/19_spring/</guid><description>&lt;p>&lt;a href="https://spring.pleiades.io/guides/gs/spring-boot-docker/">Docker で Spring Boot - 公式サンプルコード&lt;/a>を見ながらやってみた。&lt;/p>
&lt;p>ローカルにJDKが入っていなかったので、Dockerでビルドしてみたところ、うまく動かず。。&lt;/p>
&lt;p>リンクされている&lt;a href="https://start.spring.io/#!type=gradle-project&amp;amp;language=java&amp;amp;platformVersion=2.5.5&amp;amp;packaging=jar&amp;amp;jvmVersion=11&amp;amp;groupId=com.example&amp;amp;artifactId=spring-boot-docker&amp;amp;name=spring-boot-docker&amp;amp;description=Demo%20project%20for%20Spring%20Boot&amp;amp;packageName=com.example.spring-boot-docker&amp;amp;dependencies=web">Spring Initializr&lt;/a>で、Javaが11を選択されていたので、Dockerイメージも11を使ったのだが、Spring Initializrとイメージを17にしたら、通った。
&lt;del>&lt;a href="https://spring.io/guides/gs/spring-boot-docker/">英語版&lt;/a>のリンクは何もオプションパラメータがついていなくて最初から17が選択されていたので、日本語版の変更が追いついていないだけなのかもしれない。&lt;/del>&lt;/p></description></item><item><title>Docker x ChatGPT</title><link>https://umemak.github.io/blog/posts/2022/12/14_docker/</link><pubDate>Wed, 14 Dec 2022 00:00:00 +0000</pubDate><guid>https://umemak.github.io/blog/posts/2022/12/14_docker/</guid><description>&lt;p>Dockerの学習方法について、ChatGPTに聞いてみた。&lt;/p>
&lt;p>おおむね自分の認識と合った回答だった。&lt;/p>
&lt;p>もう一度やったら違う回答が出てきそうだったけど、エラーになってしまった。&lt;/p>
&lt;p>大人気で混雑してるっぽい。&lt;/p></description></item><item><title>Docker再入門</title><link>https://umemak.github.io/blog/posts/2022/12/12_docker/</link><pubDate>Mon, 12 Dec 2022 00:00:00 +0000</pubDate><guid>https://umemak.github.io/blog/posts/2022/12/12_docker/</guid><description>&lt;p>Dockerのおさらいをするために、&lt;a href="https://gihyo.jp/magazine/SD/archive/2022/202211">Software Design 2022年11月号｜技術評論社&lt;/a>の特集を読んだ。&lt;/p>
&lt;p>基本的なコンテナの仕組みへの理解が深まった気がする。&lt;/p>
&lt;p>個人的には、以前ほど何でもコンテナ化したらいいじゃんって感じではなくなって、選択肢の一つとして存在している感じ。&lt;/p>
&lt;p>まぁDocker使ってもMacとWindowsで挙動が違ったり、ラズパイ用のイメージがなかったりすることに疲れたというのもある。&lt;/p></description></item><item><title>ラズパイでDockerでMySQL</title><link>https://umemak.github.io/blog/posts/2022/12/10_raspberry_pi_vscode/</link><pubDate>Sat, 10 Dec 2022 00:00:00 +0000</pubDate><guid>https://umemak.github.io/blog/posts/2022/12/10_raspberry_pi_vscode/</guid><description>&lt;p>GitHub Codespacesが使えるようになるのを待つ間、ラズパイで何とかならないか試してみた。&lt;/p>
&lt;p>VS Codeからリモート接続して、Dockerインストールするところまでは順調だったけれど、docker compose upしたところでエラー。&lt;/p>
&lt;p>MySQLのコンテナイメージが提供されていないようだ。
意外だった。&lt;/p>
&lt;p>&lt;a href="https://registry.hub.docker.com/_/mysql/tags">mysql Tags | Docker Hub&lt;/a>には&lt;code>linux/arm64/v8&lt;/code>があるけれど、ラズパイは&lt;code>v7&lt;/code>らしい。&lt;/p></description></item><item><title>Dockerfileでブレース展開</title><link>https://umemak.github.io/blog/posts/2022/10/04_dockerfile/</link><pubDate>Tue, 04 Oct 2022 00:00:00 +0000</pubDate><guid>https://umemak.github.io/blog/posts/2022/10/04_dockerfile/</guid><description>&lt;p>golangのベースイメージにnodejsを入れたくて、
&lt;a href="https://dev.to/aashishpanthi/step-by-step-instructions-to-install-node-and-npm-using-linux-binaries-1e0h">Step by step instructions to install node and npm using Linux binaries - DEV Community 👩‍💻👨‍💻&lt;/a>
この手順見ながらやってみていたのだけれど、&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-Dockerfile" data-lang="Dockerfile">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">RUN&lt;/span> cp -r ./&lt;span style="color:#f92672">{&lt;/span>lib,share,include,bin&lt;span style="color:#f92672">}&lt;/span> /usr&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>でファイル未存在のエラーになってしまった。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-Dockerfile" data-lang="Dockerfile">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">RUN&lt;/span> cp -r ./lib /usr&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">RUN&lt;/span> cp -r ./share /usr&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">RUN&lt;/span> cp -r ./include /usr&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">RUN&lt;/span> cp -r ./bin /usr&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>とすると通るので、ファイルが存在しないわけではなく、ブレース展開ができていないらしい。&lt;/p></description></item><item><title>GitBashでDockerでMount</title><link>https://umemak.github.io/blog/posts/2022/10/01_docker_gitbash/</link><pubDate>Sat, 01 Oct 2022 00:00:00 +0000</pubDate><guid>https://umemak.github.io/blog/posts/2022/10/01_docker_gitbash/</guid><description>&lt;p>WSL2が不安定なので、開発環境をGitBash使うようにして、おおむね問題なかったのだが、Dockerでローカルをマウントして使うときに問題が。&lt;/p>
&lt;p>OpenAPIのコード生成するときに&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>docker run --rm &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -v &lt;span style="color:#e6db74">${&lt;/span>PWD&lt;span style="color:#e6db74">}&lt;/span>:/local openapitools/openapi-generator-cli generate &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -i /local/openapi.yml &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -g go-server &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --additional-properties&lt;span style="color:#f92672">=&lt;/span>router&lt;span style="color:#f92672">=&lt;/span>chi,featureCORS&lt;span style="color:#f92672">=&lt;/span>true &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -o /local/out
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>だと&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>error&lt;span style="color:#f92672">]&lt;/span> The spec file is not found: C:/Program Files/Git/local/openapi.yml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>error&lt;span style="color:#f92672">]&lt;/span> Check the path of the OpenAPI spec and try again.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>こんなエラーになる。&lt;/p>
&lt;p>&lt;a href="https://github.com/docker-archive/toolbox/issues/673">Mount volume doesn&amp;rsquo;t work on Windows 10 using git-bash · Issue #673 · docker-archive/toolbox&lt;/a>を参考に、&lt;code>MSYS_NO_PATHCONV=1&lt;/code>をつけたら動いた。&lt;/p></description></item><item><title>Docker不調</title><link>https://umemak.github.io/blog/posts/2022/09/30_wsl/</link><pubDate>Fri, 30 Sep 2022 00:00:00 +0000</pubDate><guid>https://umemak.github.io/blog/posts/2022/09/30_wsl/</guid><description>&lt;p>WSL2の不調の影響か、Docker Desktopも応答がなくなることが多い。&lt;/p>
&lt;p>せっかくのノートPCなのに、毎回シャットダウンする運用はしたくないなぁ。&lt;/p>
&lt;p>Windows11の新しいの入れたら改善したりするのかしら。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://pc.watch.impress.co.jp/docs/topic/feature/1441763.html">【特集】ついに出た！Windows 11「22H2」の変更点まとめ。どこが変わって何が新しくなったのか？ - PC Watch&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>docker composeで特定コンテナの再起動</title><link>https://umemak.github.io/blog/posts/2022/09/01_docker_restart/</link><pubDate>Thu, 01 Sep 2022 00:00:00 +0000</pubDate><guid>https://umemak.github.io/blog/posts/2022/09/01_docker_restart/</guid><description>&lt;p>&lt;code>docker compose up -d&lt;/code>で複数コンテナを動かしているときに、その中の特定のコンテナのイメージを更新して再起動したい。
できればその他のコンテナは再起動したくない。&lt;/p>
&lt;p>そんなの&lt;code>docker compose stop hogehoge&lt;/code>して&lt;code>docker compose start hogehoge&lt;/code>したらいいと思ってた。&lt;/p>
&lt;p>ログ的には再起動されるけれども、コンテナイメージは古いままだった。&lt;/p></description></item></channel></rss>